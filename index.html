<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <!-- Include the CesiumJS JavaScript and CSS files -->
    <script>
      window.$ = window.jQuery = require('./assets/js/jquery.js');
    </script>

    <script src="./assets/js/particles.min.js"></script>

    <link rel="stylesheet" type="text/css" href="./assets/gauges/css/flightindicators.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js" integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.83/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.83/Build/Cesium/Cesium.js"></script>

    <title>DATAD</title>


  </head>
  <body style="height: 1000px;max-height: 1000px;overflow-y:hidden">
    <div class="container main container" style="margin: 0;padding: 20px 30px;width: 100%;max-width: 100%;">
      <div class="row">
        <div class="col-sm-2">
          <div class="row">

            <div class="col-sm-12" style="padding: 0;">
              <div id="connessione_centralina"></div>            
            </div>

            <div class="col-sm-12" style="padding: 0;">
              <div id="impostazioni_generali"></div>
              <div id="param_button" style="display: none;"></div>
            </div>

            <div class="col-sm-12" >
              <div id="adsb_container" style="display: none;"></div>             
            </div>

          </div>   
        </div>
        <div class="col-sm-8" id="cesiumBox" style="text-align: center;position: relative">

            <div id="overlayCommands" class="row"></div>

            <div id="cesiumContainer" style="max-height: 1000px;"></div>

            <div id="planeCamera">
              <div id="container">
                <canvas id="canvasVideo" width='1000' height='1000' style="display: none"></canvas>


                <div id="loadingCamera" style="width: 1000px;height: 1000px;position: relative">
                  <div style="width:1200px;height:1000px;position:absolute;background: rgb(75,169,200);
background: radial-gradient(circle, rgba(75,169,200,1) 0%, rgba(255,255,255,1) 50%, rgba(255,255,255,1) 56%);">
                    <img class="plane" src="assets/img/loading.svg" style="top:35%;width: 200px;left:40%">
                    <div style="    position: absolute;
    font-size: 30px !important;
    top: 60%;
    left: 44%;
    color: azure;">LOADING...</div>
                    <span class="cloud cloud--medium" style="top:55%"></span>
                    <span class="cloud cloud--large" style="top:45%"></span>
                    <span class="cloud cloud--small" style="top:50%"></span>

                  </div>


                </div>


                <style>
                  .plane,.cloud{
                    position:absolute;
                  }
                  /*plane animation*/
                  .plane{
                    animation-duration: 1s;
                    animation-name: anim-plane;
                    animation-iteration-count: infinite;
                    animation-direction: alternate;
                    animation-timing-function:linear;

                    animation-fill-mode:forwards;
                    display:block;
                    margin:0 auto;
                    transform: translateY(80px);
                    left:30%;
                  }

                  @keyframes anim-plane{
                    to{
                      transform:translateY(95px);
                    }
                  }


                  /* Cloud Animation */

                  @keyframes fade{
                    0%{ opacity: 0;}
                    10%{ opacity: 1;}
                    90%{ opacity:1;}
                    100%{ opacity:0;}
                  }

                  @keyframes move{
                    from{
                      left:700px;
                    }
                    to{
                      left:400px;
                    }
                  }


                  .cloud{
                    animation-duration:10s;
                    animation-name:move, fade;
                    animation-direction: normal;
                    animation-iteration-count:infinite;
                    animation-timing-function:linear;
                    animation-fill-mode:both;

                    display:block;
                    background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iY2xvdWQiIHZpZXdCb3g9IjAgMCA1MiA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MnB4IiBoZWlnaHQ9IjQwcHgiPgoJPGRlZnM+CgkJPGZpbHRlciBpZD0iZjEiIHg9Ii0xMDAlIiB5PSItMTAwJSIgd2lkdGg9IjMwMCUiIGhlaWdodD0iMzAwJSI+IAoJCQk8ZmVPZmZzZXQgcmVzdWx0PSJvdXQiIGluPSJTb3VyY2VHcmFwaGljIiBkeD0iMCIgZHk9IjEiLz4KCQkJPGZlQ29sb3JNYXRyaXggcmVzdWx0PSJvdXQiIGluPSJvdXQiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgIDAgMCAwIDAgMCAgMCAwIDAgMCAwICAwIDAgMCAwLjQgMCIvPgoJCQk8ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJvdXQiIGluPSJvdXQiIHN0ZERldmlhdGlvbj0iMiIvPgoJCQk8ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJvdXQiIG1vZGU9Im5vcm1hbCIgcmVzdWx0PSJkcCIvPgoJCTwvZmlsdGVyPgoJPC9kZWZzPiAKCTxwYXRoIGlkPSJmZy1jbG91ZCIgZmlsdGVyPSJ1cmwoI2YxKSIgZD0iTTYuMyAzNS4xQzQuNyAzNC4yLTAuNCAzMi4zIDEuNCAyNSAzLjEgMTguMSA4LjcgMTkuNSA4LjcgMTkuNSA4LjcgMTkuNSAzLjIgMTQuMSAxMC40IDYuOCAxNi45IDAuMiAyMy4xIDQuNiAyMy4xIDQuNiAyMy4xIDQuNiAzMC0xLjcgMzUuMiAyLjQgNDQuNiA5LjcgNDIuOCAyNS4zIDQyLjggMjUuMyA0Mi44IDI1LjMgNDggMjIuNiA0OS44IDI4LjYgNTEgMzIuNyA0NiAzNS44IDQyLjggMzYuNyAzOS43IDM3LjUgOC45IDM2LjYgNi4zIDM1LjFaIiBzdHJva2U9IiNjY2NjY2MiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0iI2ZmZmZmZiIvPgo8L3N2Zz4=);
                    height:40px;
                    width:53px;
                    margin:0 auto;
                  }
                  .cloud--small{
                    animation-duration:6s;
                    top:65px;
                    transform: scaleX(0.5) scaleY(0.5);
                  }
                  .cloud--medium{
                    animation-duration:5s;
                    animation-delay:1s;
                    top:95px;
                    transform: scaleX(0.7) scaleY(0.7);
                  }
                  .cloud--large{
                    animation-duration:4.5s;
                    animation-delay:2.5s;
                    top:95px;
                    transform: scaleX(0.8) scaleY(0.8);
                  }

                </style>

              </div>
            </div>

            <div id="tettolone" style="padding: 0;position: absolute;bottom:0;width: 100%;"></div>
        </div>
        <div class="col-sm-2">
          <div id="flight_data" style="padding: 0;display: block;"></div>
          <div id="antennaGPS" style="display: block;"></div>
        </div>
      </div>
    </div>
    <div id="modals"></div>
  </body>

  <script src="./assets/gauges/js/jquery.flightindicators.js"></script>
  <script>
    const JQueryParameterRenderer = require("./classes/renderData/JQueryParameterRenderer").JQueryParameterRenderer;
    const DatadCesium = require('./classes/DatadCesium').DatadCesium;
    const PortConnection = require('./classes/portConnection/PortConnection').PortConnection;
    const FlightData = require('./classes/dataReader/FlightData').FlightData;
    const CustomAlert = require('./classes/utility/CustomAlert').CustomAlert;
    const MavlinkParams = require('./classes/dataReader/MavlinkParams').MavlinkParams;
    const AdsbPlaneList = require("./classes/adsb/AdsbPlaneList").AdsbPlaneList;
    const PlaneCamera = require("./classes/camera/Camera").Camera;

    $('#cesiumContainer').height("950px")

    globalThis.portname = "COM7";
    globalThis.baud = 115200;
    globalThis.portnameWrite = "COM5";
    globalThis.baudWrite = 115200;
    globalThis.connectionStatus = false;
    globalThis.renderCycle = false;
    globalThis.fetchData = false;
    globalThis.lat = 44.647036;
    globalThis.lon = 10.923773;
    globalThis.alt = 120;
    globalThis.heading = Cesium.Math.toRadians(120);
    globalThis.pitch = 0;
    globalThis.roll = 0;
    globalThis.alt_delta=0;
    globalThis.delta_increase = 0;
    globalThis.attitude_time = 0;
    globalThis.current_sium = 1;
    globalThis.current_zoom = 40;
    globalThis.new_heading = 0;
    globalThis.new_pitch = 0;
    globalThis.new_roll = 0;
    //globalThis.first_person = 1;
    globalThis.write_data = false;

    globalThis.AccMin = 1;
    globalThis.AccMax = 1;
    globalThis.Vibr = 0;

    globalThis.paramValueList = []
    globalThis.paramDesc = []

    globalThis.VelRel = 0;

    globalThis.adsbVehicles = [];
    globalThis.adsbMapPlanes = []
    globalThis.adsbMapEntity = []
    globalThis.adsbMapEntityText = []

    globalThis.temp_lat = 0;
    globalThis.temp_lon = 0;
    globalThis.temp_alt = 0;

    globalThis.altitudeGauge = undefined
    globalThis.pressure = undefined

    //Modena
    //globalThis.antennaX = 446854530
    //globalThis.antennaY = 107400070
    //globalThis.antennaZ = 0

    //Casa giovanardi
    globalThis.antennaX = 0
    globalThis.antennaY = 0
    globalThis.antennaZ = 0


    window.onload= function() {

      //Salvo i parametri del file nella classe statica
      MavlinkParams.populateParams();

      //Non mi serve istanziare FlightData in quanto classe statica
      DatadCesium.createEverything().then(r => DatadCesium.startRenderLoop());

      new PortConnection();

      //Se voglio fare partire il loop di controllo degli aerei ADSB devo fare
      AdsbPlaneList.createCheckLoop();

      //Creo il listener per i vari bottoni
      JQueryParameterRenderer.createParamsButtonListener();

      //Preparo la camera
      PlaneCamera.createListener();

    }

  </script>
  
  <script src="moduli_js/utils.js"></script>
  <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
  <link href="./assets/css/style.css" rel="stylesheet">
  <script src="./assets/js/bootstrap.min.js"></script>
  
</html>